# دليل تنفيذ الإصلاحات - Bawwabty Project

**تاريخ**: 11 يناير 2026  
**الإصدار**: 1.0

## نظرة عامة

هذا الدليل يوضح كيفية تنفيذ الإصلاحات التي تم تحديدها في التقرير الشامل لمشروع بوابتي. الإصلاحات مقسمة حسب الأولوية ويجب تنفيذها بالترتيب.

---

## المرحلة الأولى: إصلاح قاعدة البيانات (حرجة)

### الخطوة 1: تنفيذ ملف الإصلاحات الحرجة

1. افتح Supabase Dashboard
2. انتقل إلى SQL Editor
3. افتح ملف `database/migrations/fix_critical_issues.sql`
4. انسخ المحتوى بالكامل
5. الصقه في SQL Editor
6. اضغط على "Run" لتنفيذ الاستعلامات

**ما يفعله هذا الملف:**
- إضافة عمود `currency` إلى جدول `orders`
- حذف المستخدمين المكررين (البريد الإلكتروني المكرر)
- إضافة قيد UNIQUE على البريد الإلكتروني
- إصلاح مشكلة "بائع غير معروف" بربط المنتجات بالمتاجر
- تحديث أسماء المنتجات التجريبية
- إضافة تقييمات واقعية للمنتجات
- إضافة indexes لتحسين الأداء

**الوقت المتوقع:** 2-5 دقائق

### الخطوة 2: تحديث البيانات التجريبية

1. في نفس SQL Editor
2. افتح ملف `database/migrations/update_sample_data.sql`
3. انسخ المحتوى بالكامل
4. الصقه في SQL Editor
5. اضغط على "Run"

**ما يفعله هذا الملف:**
- تحديث أسماء وأوصاف المنتجات بأسماء واقعية
- تحديث أسماء وأوصاف وجبات المطاعم
- تحديث معلومات المتاجر والمطاعم
- تقريب جميع الأسعار إلى منزلتين عشريتين
- إضافة فئات للمنتجات

**الوقت المتوقع:** 1-2 دقيقة

---

## المرحلة الثانية: التحقق من الإصلاحات

### التحقق من قاعدة البيانات

قم بتشغيل الاستعلامات التالية للتحقق من نجاح الإصلاحات:

```sql
-- 1. التحقق من عدم وجود بريد إلكتروني مكرر
SELECT email, COUNT(*) as count 
FROM users 
GROUP BY email 
HAVING COUNT(*) > 1;
-- يجب أن يكون الناتج فارغاً

-- 2. التحقق من وجود عمود currency
SELECT currency, COUNT(*) 
FROM orders 
GROUP BY currency;
-- يجب أن ترى العملات المستخدمة

-- 3. التحقق من ربط المنتجات بالمتاجر
SELECT p.id, p.name, s.name as store_name 
FROM products p 
LEFT JOIN stores s ON p.vendor_id = s.id 
WHERE s.id IS NULL;
-- يجب أن يكون الناتج فارغاً

-- 4. التحقق من أسماء المنتجات
SELECT name, COUNT(*) 
FROM products 
WHERE LOWER(name) IN ('تست', 'jsj') 
GROUP BY name;
-- يجب أن يكون الناتج فارغاً أو قليل جداً

-- 5. التحقق من وجود تقييمات
SELECT COUNT(*) as total_reviews 
FROM reviews;
-- يجب أن يكون العدد أكبر من 0
```

---

## المرحلة الثالثة: اختبار الموقع المباشر

### 1. اختبار تسجيل الدخول

- قم بتسجيل الدخول بحسابات مختلفة (admin, vendor, restaurant, customer)
- تأكد من التحويل التلقائي إلى لوحة التحكم المناسبة
- تحقق من عدم ظهور رسائل خطأ

### 2. اختبار عرض المنتجات

- افتح الصفحة الرئيسية
- تحقق من أن جميع المنتجات تعرض اسم البائع بشكل صحيح
- تأكد من أن أسماء المنتجات واقعية وواضحة
- تحقق من أن الأسعار مقربة بشكل صحيح

### 3. اختبار التقييمات

- افتح صفحة أي منتج
- تحقق من ظهور التقييمات
- تأكد من أن عدد التقييمات والنجوم يظهر بشكل صحيح

### 4. اختبار الطلبات

- قم بإنشاء طلب جديد
- تحقق من حفظ العملة بشكل صحيح
- تأكد من أن الطلب يظهر في لوحة تحكم البائع/المطعم

---

## المرحلة الرابعة: إصلاحات إضافية (اختيارية)

### 1. إضافة صفحات قانونية

يجب إضافة الصفحات التالية:
- سياسة الخصوصية (`/privacy-policy`)
- الشروط والأحكام (`/terms-and-conditions`)
- سياسة الإرجاع (`/return-policy`)

### 2. تحسين الأداء

- ضغط الصور في مجلد `/public`
- تفعيل Caching في Vercel
- استخدام Next.js Image Optimization

### 3. إضافة اختبارات

- إضافة Unit Tests للمكونات الأساسية
- إضافة Integration Tests للـ API
- إضافة E2E Tests للمسارات الحرجة

---

## المشاكل المعروفة والحلول

### مشكلة: عدم التحويل التلقائي بعد تسجيل الدخول

**الحل:** تم إصلاحها في الكود الحالي. إذا استمرت المشكلة:
1. تحقق من ملف `/app/auth/login/page.tsx`
2. تأكد من أن دالة `redirectUserByRole` تعمل بشكل صحيح
3. تحقق من console في المتصفح للأخطاء

### مشكلة: بطء تحميل الصفحات

**الحل:**
1. تفعيل Caching في Vercel
2. استخدام ISR (Incremental Static Regeneration) للصفحات الثابتة
3. تحسين استعلامات قاعدة البيانات

### مشكلة: أخطاء في RLS (Row Level Security)

**الحل:**
1. راجع policies في Supabase Dashboard
2. تأكد من أن جميع الجداول لديها policies صحيحة
3. استخدم `service_role` key للعمليات الإدارية

---

## الخطوات التالية

بعد تنفيذ جميع الإصلاحات، يُنصح بـ:

1. **مراقبة الأداء**: استخدم Vercel Analytics لمراقبة أداء الموقع
2. **جمع التغذية الراجعة**: اطلب من المستخدمين التجريبيين تجربة الموقع
3. **إضافة ميزات جديدة**: راجع قسم "الإضافات المقترحة" في التقرير الشامل
4. **تحديث التوثيق**: حدّث README.md و CHANGELOG.md

---

## الدعم والمساعدة

إذا واجهت أي مشاكل أثناء تنفيذ الإصلاحات:

1. راجع سجلات الأخطاء في Vercel Dashboard
2. تحقق من Supabase Logs
3. راجع ملف `FIXES_LOG.md` لتتبع الإصلاحات المنفذة

---

**ملاحظة مهمة:** تأكد من أخذ نسخة احتياطية من قاعدة البيانات قبل تنفيذ أي إصلاحات!
