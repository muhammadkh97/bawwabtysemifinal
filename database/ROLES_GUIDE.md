# ุฏููู ุงูุฃุฏูุงุฑ ูู ูุธุงู Bawwabty

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฏุนู ูุธุงู Bawwabty ุฎูุณุฉ ุฃุฏูุงุฑ ุฑุฆูุณูุฉ ูููุณุชุฎุฏููู:

### 1. ๐ค Customer (ุนููู)
- **ุงูุฏูุฑ**: `customer`
- **ุงููุตู**: ุงููุณุชุฎุฏู ุงูุนุงุฏู ุงูุฐู ูุชุตูุญ ุงูููุชุฌุงุช ููููู ุจุงูุดุฑุงุก
- **ุงูุตูุงุญูุงุช**:
  - ุชุตูุญ ุงูููุชุฌุงุช ูุงููุชุงุฌุฑ ูุงููุทุงุนู
  - ุฅุถุงูุฉ ุงูููุชุฌุงุช ููุณูุฉ ูุงูููุถูุฉ
  - ุฅุชูุงู ุงูุทูุจุงุช
  - ุชุชุจุน ุงูุทูุจุงุช
  - ุงูุชูููู ูุงููุฑุงุฌุนุงุช
  - ุงููุญุงุฏุซุฉ ูุน ุงูุจุงุฆุนูู ูุงููุทุงุนู

### 2. ๐ช Vendor (ุจุงุฆุน - ูุชุฌุฑ ุชุฌุฒุฆุฉ)
- **ุงูุฏูุฑ**: `vendor`
- **ููุน ุงูุนูู**: `business_type = 'retail'`
- **ุงููุตู**: ุตุงุญุจ ูุชุฌุฑ ุชุฌุฒุฆุฉ (ุฅููุชุฑูููุงุชุ ููุงุจุณุ ุฅูุฎ)
- **ููุญุฉ ุงูุชุญูู**: `/dashboard/vendor`
- **ุงูุตูุงุญูุงุช**:
  - ุฅุฏุงุฑุฉ ุงููุชุฌุฑ (ุฅุนุฏุงุฏุงุชุ ุณุงุนุงุช ุงูุนูู)
  - ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช (ุฅุถุงูุฉุ ุชุนุฏููุ ุญุฐู)
  - ุฅุฏุงุฑุฉ ุงููุฎุฒูู
  - ูุชุงุจุนุฉ ุงูุทูุจุงุช
  - ุฅุฏุงุฑุฉ ุงููุญูุธุฉ ูุงูุฃุฑุจุงุญ
  - ุงูุฑุฏ ุนูู ุงูุชููููุงุช
  - ุงููุญุงุฏุซุฉ ูุน ุงูุนููุงุก

### 3. ๐ฝ๏ธ Restaurant (ูุทุนู)
- **ุงูุฏูุฑ**: `restaurant` โญ ุฌุฏูุฏ!
- **ููุน ุงูุนูู**: `business_type = 'restaurant'`
- **ุงููุตู**: ุตุงุญุจ ูุทุนู
- **ููุญุฉ ุงูุชุญูู**: `/dashboard/restaurant`
- **ุงูุตูุงุญูุงุช**:
  - ุฅุฏุงุฑุฉ ุงููุทุนู (ุฅุนุฏุงุฏุงุชุ ุณุงุนุงุช ุงูุนูู)
  - ุฅุฏุงุฑุฉ ูุงุฆูุฉ ุงูุทุนุงู (ุงููุฌุจุงุช)
  - ูุชุงุจุนุฉ ุงูุทูุจุงุช
  - ุฅุฏุงุฑุฉ ุงููุญูุธุฉ ูุงูุฃุฑุจุงุญ
  - ุฅุฏุงุฑุฉ ุงูุนุฑูุถ ูุงูููุจููุงุช
  - ุงูุฑุฏ ุนูู ุงูุชููููุงุช
  - ุงููุญุงุฏุซุฉ ูุน ุงูุนููุงุก

### 4. ๐ Driver (ููุฏูุจ ุชูุตูู)
- **ุงูุฏูุฑ**: `driver`
- **ุงููุตู**: ููุฏูุจ ุงูุชูุตูู
- **ููุญุฉ ุงูุชุญูู**: `/dashboard/driver`
- **ุงูุตูุงุญูุงุช**:
  - ุนุฑุถ ุงูุทูุจุงุช ุงููุชุงุญุฉ
  - ูุจูู ุงูุทูุจุงุช
  - ุชุชุจุน ูููุน ุงูุชูุตูู
  - ุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุชูุตูู
  - ุนุฑุถ ุงูุฃุฑุจุงุญ

### 5. ๐ Admin (ูุฏูุฑ ุงููุธุงู)
- **ุงูุฏูุฑ**: `admin`
- **ุงููุตู**: ูุฏูุฑ ุงููุธุงู
- **ููุญุฉ ุงูุชุญูู**: `/dashboard/admin`
- **ุงูุตูุงุญูุงุช**:
  - ุฅุฏุงุฑุฉ ุฌููุน ุงููุณุชุฎุฏููู
  - ุงูููุงููุฉ ุนูู ุงููุชุงุฌุฑ ูุงููุทุงุนู
  - ุฅุฏุงุฑุฉ ุงูุทูุจุงุช ูุงููุฒุงุนุงุช
  - ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงููุงููุฉ
  - ุฅุฏุงุฑุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ

---

## ๐ ุงููุฑู ุจูู Vendor ู Restaurant

### ูุฏููุงู (ูุจู ุงูุชุญุฏูุซ):
```
vendor โ ูุดูู ุงููุชุงุฌุฑ ูุงููุทุงุนู ูุนุงู
โโโ business_type: 'retail' ุฃู 'restaurant'
```

### ุญุงููุงู (ุจุนุฏ ุงูุชุญุฏูุซ):
```
vendor โ ูุชุงุฌุฑ ุงูุชุฌุฒุฆุฉ ููุท
โโโ business_type: 'retail'

restaurant โ ุงููุทุงุนู ููุท โญ
โโโ business_type: 'restaurant'
```

### ููุงุฐุง ุงููุตูุ

1. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู**: 
   - ููุญุฉ ุชุญูู ูุฎุตุตุฉ ูููุทุงุนู ูุน ูุตุทูุญุงุช ููุงุฆูุฉ (ูุงุฆูุฉ ุงูุทุนุงู ุจุฏูุงู ูู ุงูููุชุฌุงุช)
   - ุฃููููุงุช ูุฃููุงู ูููุฒุฉ (ุจุฑุชูุงูู ูููุทุงุนูุ ุจููุณุฌู ูููุชุงุฌุฑ)

2. **ูุฑููุฉ ูู ุงูุตูุงุญูุงุช**:
   - ุตูุงุญูุงุช ูุฎุตุตุฉ ูููุทุงุนู (ุฅุฏุงุฑุฉ ุงููุฌุจุงุชุ ุงูุนุฑูุถ ุงูููููุฉ)
   - ุตูุงุญูุงุช ูุฎุตุตุฉ ูููุชุงุฌุฑ (ุฅุฏุงุฑุฉ ุงููุฎุฒููุ ุงููุชุบูุฑุงุช)

3. **ุชูุงุฑูุฑ ูุฅุญุตุงุฆูุงุช ูููุตูุฉ**:
   - ุชูุงุฑูุฑ ุฎุงุตุฉ ุจุงููุทุงุนู
   - ุชูุงุฑูุฑ ุฎุงุตุฉ ุจุงููุชุงุฌุฑ

---

## ๐ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู users
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  full_name TEXT NOT NULL,
  role user_role NOT NULL DEFAULT 'customer',
  -- role ูููู ุฃู ูููู:
  -- 'customer', 'vendor', 'restaurant', 'driver', 'admin'
  ...
);
```

### ุฌุฏูู stores (ุงููุชุงุฌุฑ ูุงููุทุงุนู ูุนุงู)
```sql
CREATE TABLE stores (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  name TEXT NOT NULL,
  business_type business_type NOT NULL DEFAULT 'retail',
  -- business_type ูุญุฏุฏ ููุน ุงูุนูู:
  -- 'retail' = ูุชุฌุฑ ุชุฌุฒุฆุฉ
  -- 'restaurant' = ูุทุนู
  ...
);
```

### ุงูุนูุงูุฉ
```
users.role = 'vendor' โ stores.business_type = 'retail'
users.role = 'restaurant' โ stores.business_type = 'restaurant'
```

---

## ๐ง ููููุฉ ุฅุนุฏุงุฏ ูุณุชุฎุฏู ุฌุฏูุฏ

### ุฅูุดุงุก ุจุงุฆุน (ูุชุฌุฑ):
```sql
-- 1. ุชุญุฏูุซ ุฏูุฑ ุงููุณุชุฎุฏู
UPDATE users 
SET role = 'vendor'
WHERE email = 'vendor@example.com';

-- 2. ุฅูุดุงุก ูุชุฌุฑ
INSERT INTO stores (user_id, name, business_type, ...)
SELECT id, 'ุงุณู ุงููุชุฌุฑ', 'retail', ...
FROM users
WHERE email = 'vendor@example.com';
```

### ุฅูุดุงุก ุตุงุญุจ ูุทุนู:
```sql
-- 1. ุชุญุฏูุซ ุฏูุฑ ุงููุณุชุฎุฏู
UPDATE users 
SET role = 'restaurant'
WHERE email = 'restaurant@example.com';

-- 2. ุฅูุดุงุก ูุทุนู
INSERT INTO stores (user_id, name, business_type, ...)
SELECT id, 'ุงุณู ุงููุทุนู', 'restaurant', ...
FROM users
WHERE email = 'restaurant@example.com';
```

### ุชุญููู ุจุงุฆุน ููุฌูุฏ ุฅูู ูุทุนู:
```sql
-- 1. ุชุญุฏูุซ ุฏูุฑ ุงููุณุชุฎุฏู
UPDATE users 
SET role = 'restaurant'
WHERE email = 'existing-vendor@example.com';

-- 2. ุชุญุฏูุซ ููุน ุงูุนูู ูู ุงููุชุฌุฑ
UPDATE stores s
SET business_type = 'restaurant'
FROM users u
WHERE s.user_id = u.id
AND u.email = 'existing-vendor@example.com';
```

---

## ๐ฃ๏ธ ุงููุณุงุฑุงุช (Routes)

### ููุญุงุช ุงูุชุญูู:
```
/dashboard/admin      โ ุงููุฏูุฑ
/dashboard/vendor     โ ุงูุจุงุฆุน (ูุชุฌุฑ)
/dashboard/restaurant โ ุงููุทุนู
/dashboard/driver     โ ุงูุณุงุฆู
```

### ุงูุตูุญุงุช ุงูุนุงูุฉ:
```
/vendors      โ ุนุฑุถ ุฌููุน ุงููุชุงุฌุฑ
/restaurants  โ ุนุฑุถ ุฌููุน ุงููุทุงุนู
/vendor/[id]  โ ุตูุญุฉ ูุชุฌุฑ ุฃู ูุทุนู ูุญุฏุฏ (ูุชู ุงูุชูููุฒ ุชููุงุฆูุงู)
```

---

## ๐ ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูุชููุงุฆู

ุนูุฏ ุชุณุฌูู ุงูุฏุฎููุ ูุชู ุชูุฌูู ุงููุณุชุฎุฏู ุชููุงุฆูุงู ุญุณุจ ุฏูุฑู:

```typescript
switch (userRole) {
  case 'admin':
    โ '/dashboard/admin'
  case 'vendor':
    โ '/dashboard/vendor'
  case 'restaurant':
    โ '/dashboard/restaurant'
  case 'driver':
    โ '/dashboard/driver'
  case 'customer':
  default:
    โ '/'
}
```

---

## ๐ ุงูุญูุงูุฉ (RLS Policies)

### ุณูุงุณุงุช ุงููุทุงุนู:
```sql
-- ูููู ูุฃุตุญุงุจ ุงููุทุงุนู ุฅุฏุงุฑุฉ ูุชุงุฌุฑูู
CREATE POLICY "Restaurant owners can manage stores" 
ON stores FOR ALL 
USING (auth.uid() = user_id);

-- ูููู ูุฃุตุญุงุจ ุงููุทุงุนู ุฅุฏุงุฑุฉ ููุชุฌุงุชูู
CREATE POLICY "Restaurants can manage own products" 
ON products FOR ALL 
USING (
  vendor_id IN (
    SELECT id FROM stores 
    WHERE user_id = auth.uid()
  )
);
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุจุนุฏ ุชุดุบูู ุงูุณูุฑูุจุช**:
   - ุงุฐูุจ ุฅูู Supabase Dashboard
   - Settings โ API
   - ุงุถุบุท "Reload schema cache"

2. **ุงููุณุชุฎุฏููู ุงูุญุงูููู**:
   - ุงูุจุงุฆุนูู ุงูุฐูู ูุฏููู ูุทุงุนู ูุฌุจ ุชุญููููู ูุฏููุงู
   - ุงุณุชุฎุฏู ุงูุณูุฑูุจุช `add_restaurant_role.sql`

3. **ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ**:
   - ุฌุฏูู `vendors` ูุง ูุฒุงู ููุฌูุฏุงู ููุชูุงูู
   - ูุชู ุงููุฒุงููุฉ ุชููุงุฆูุงู ูุน ุฌุฏูู `stores` ุนุจุฑ triggers

4. **ุงูุงุฎุชุจุงุฑ**:
   - ุงุฎุชุจุฑ ุชุณุฌูู ุงูุฏุฎูู ููู ุฏูุฑ
   - ุชุญูู ูู ุงููุตูู ูููุญุงุช ุงูุชุญูู
   - ุชุฃูุฏ ูู ุธููุฑ ุงูููุงุฆู ุงูููุงุณุจุฉ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. ุชุดุบูู `add_restaurant_role.sql` ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุฅุนุงุฏุฉ ุชุญููู Schema Cache
3. ุชุญุฏูุซ ุงููุณุชุฎุฏููู ุงูุญุงูููู ุญุณุจ ุงูุญุงุฌุฉ
4. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู ููู ุฏูุฑ
5. Deploy ุงูุชุทุจูู

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู console.log ูู ุงููุชุตูุญ
2. ุฑุงุฌุน logs ูู Supabase Dashboard
3. ุชุฃูุฏ ูู ุชุทุงุจู `users.role` ูุน `stores.business_type`
