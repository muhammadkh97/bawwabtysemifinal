# ๐ฏ ุฅุตูุงุญ ูุธุงู ุงูุฏุฑุฏุดุฉ - ุชูุฑูุฑ ุดุงูู

ุงูุชุงุฑูุฎ: 2026-01-07

## ๐ ููุฎุต ุงูุชุญุณููุงุช

### โ ุงููุดุงูู ุงูุชู ุชู ุญููุง:

1. โ **ุตูุงุญูุงุช ุงูุฅุฑุณุงู** - ุงูุณูุงุญ ูุฌููุน ุงูุฃุฏูุงุฑ ุจุฅุฑุณุงู ุงูุฑุณุงุฆู
2. โ **ุฎุงุตูุฉ ุงูุฅูููุฌู** - ุฅุถุงูุฉ Emoji Picker
3. โ **ุงูุชุญุฏูุซ ุงููุณุชูุฑ** - ุชุญุณูู Real-time subscriptions
4. โ **ุนุฑุถ ุงููุญุงุฏุซุงุช** - ุนุฑุถ ุงููุญุงุฏุซุงุช ุงูุฎุงุตุฉ ุจุงููุณุชุฎุฏู ููุท (ูุซู ูุงุชุณุงุจ)

---

## ๐ 1. ุฅุตูุงุญ Policies ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูููู: `migrations/006_fix_chat_system_complete.sql`

#### ุงูุชุบููุฑุงุช:

**Policies ุฌุฏูู `chats`:**
- `chats_select_for_participants` - ุงููุณุชุฎุฏู ูุฑู ูุญุงุฏุซุงุชู ููุท
- `chats_insert_for_authenticated` - ุฃู ูุณุชุฎุฏู ููููู ุฅูุดุงุก ูุญุงุฏุซุฉ
- `chats_update_for_participants` - ุงูุฃุทุฑุงู ุงููุดุงุฑูุฉ ููุท
- `chats_delete_for_admin` - ุงูุฃุฏูู ููุท

**Policies ุฌุฏูู `messages`:**
- `messages_select_for_chat_participants` - ุฑุคูุฉ ุฑุณุงุฆู ุงููุญุงุฏุซุงุช ุงูุฎุงุตุฉ ููุท
- `messages_insert_for_chat_participants` - ุฌููุน ุงูุฃุฏูุงุฑ ูููููุง ุงูุฅุฑุณุงู
- `messages_update_for_sender_or_admin` - ุงููุฑุณู ุฃู ุงูุฃุฏูู
- `messages_delete_for_sender_or_admin` - ุงููุฑุณู ุฃู ุงูุฃุฏูู

**ุชุญุฏูุซ Function:**
- `create_or_get_chat()` - ุฏุนู ุฌููุน ุงูุฃุฏูุงุฑ (customer, vendor, admin, driver, restaurant)

---

## ๐จ 2. ุชุญุณูู ChatsContext

### ุงูููู: `contexts/ChatsContext.tsx`

#### ุงูุชุญุณููุงุช ุงูุฑุฆูุณูุฉ:

**1. ููุชุฑุฉ ุงููุญุงุฏุซุงุช ุญุณุจ ุงููุณุชุฎุฏู:**
```typescript
// ุงูุนููู ูุฑู ูุญุงุฏุซุงุชู ููุท
if (userRole === 'customer') {
  query = query.eq('customer_id', userId);
} 
// ุงูุจุงุฆุน ูุฑู ูุญุงุฏุซุงุช ูุชุฌุฑู
else if (userRole === 'vendor') {
  query = query.eq('vendor_id', storeId);
}
// ุงูุฃุฏูู ูุฑู ูู ุดูุก
```

**2. ุชุญุณูู Real-time Subscriptions:**
- ุชุญุฏูุซ ูุญูู ุจุฏูู re-fetch ูุงูู
- ููุชุฑุฉ ุงูุงุดุชุฑุงูุงุช ุญุณุจ ุงููุณุชุฎุฏู
- ุชูููู ุนุฏุฏ ุงูุชุญุฏูุซุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ

**3. ุฅุตูุงุญ formatChatForUser:**
- ุฅุตูุงุญ ุฃุณูุงุก ุงูุญููู: `shop_name` ุจุฏูุงู ูู `store_name`
- ุฅุตูุงุญ: `logo` ุจุฏูุงู ูู `logo_url`

---

## ๐ 3. ุฅุถุงูุฉ Emoji Picker

### ุงูููู: `app/chats/page.tsx`

#### ุงูุชุญุณููุงุช:

**1. ุชุซุจูุช ุงูููุชุจุฉ:**
```bash
npm install emoji-picker-react
```

**2. ุงูููุฒุงุช:**
- โ ุฒุฑ Emoji ุจุฌุงูุจ ุญูู ุงูุฅุฏุฎุงู
- โ Picker ูุธูุฑ/ูุฎุชูู ุนูุฏ ุงูุถุบุท
- โ ุฅุบูุงู ุชููุงุฆู ุนูุฏ ุงูุถุบุท ุฎุงุฑุฌ Picker
- โ ุฅุถุงูุฉ Emoji ููุฑุณุงูุฉ ุจููุฑุฉ ูุงุญุฏุฉ
- โ Theme ุฏุงูู ูุชูุงุณู ูุน ุงูุชุตููู

---

## ๐ 4. ุฅุตูุงุญ ุงูุชุญุฏูุซ ุงููุณุชูุฑ

### ุงูุชุญุณููุงุช:

**ูุจู:**
```typescript
// ูุงู ูุนูู re-fetch ูุงูู ุนูุฏ ุฃู ุชุญุฏูุซ
subscribeToChatsChanges() => fetchChats()
```

**ุจุนุฏ:**
```typescript
// ุชุญุฏูุซ ูุญูู ููุท
setChats(prev => prev.map(chat => 
  chat.id === payload.new.id 
    ? formatChatForUser(payload.new, userRole, userId)
    : chat
));
```

**ุงููุชูุฌุฉ:**
- โก ุฃุฏุงุก ุฃุณุฑุน ุจูุซูุฑ
- ๐ ุชูููู ุงุณุชุฎุฏุงู bandwidth
- ๐ ุชุญุฏูุซุงุช ุณูุณุฉ ุจุฏูู ูููุถ

---

## ๐ฑ 5. ุชุญุณูู UI/UX

### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:

1. **ุนุฑุถ ุงููุญุงุฏุซุงุช ุงูุตุญูุญ:**
   - ุงูุนููู ูุฑู ูุญุงุฏุซุงุชู ูุน ุงูุจุงุฆุนูู ููุท
   - ุงูุจุงุฆุน ูุฑู ูุญุงุฏุซุงุชู ูุน ุนููุงุฆู ููุท
   - ูุง ุชุธูุฑ ูุญุงุฏุซุงุช ุงูุขุฎุฑูู

2. **Emoji Picker ูุญุณูู:**
   - ููุถุน ุงุณุชุฑุงุชูุฌู (bottom-right)
   - Animation ุณูุณุฉ
   - ุฅุบูุงู ุฐูู

3. **Real-time ูุญุณูู:**
   - ูุง ูุฒูุฏ ูู ุงูุชุญุฏูุซุงุช ุงููุณุชูุฑุฉ
   - ุชุญุฏูุซุงุช ููุท ุนูุฏ ุงูุญุงุฌุฉ

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุชุทุจูู ุชุบููุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```sql
-- ููุฐ ูุฐุง ุงูุณูุฑูุจุช ูู Supabase SQL Editor
\i migrations/006_fix_chat_system_complete.sql
```

### 2. ุงูุชุฃูุฏ ูู ุงูุชุซุจูุช:

```bash
npm install emoji-picker-react
```

### 3. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ:

```bash
npm run dev
```

---

## โ ุงูุงุฎุชุจุงุฑุงุช ุงููุทููุจุฉ

### ุงุฎุชุจุงุฑ 1: ุงูุตูุงุญูุงุช
- [ ] ุชุณุฌูู ุฏุฎูู ูุนููู - ุฅุฑุณุงู ุฑุณุงูุฉ
- [ ] ุชุณุฌูู ุฏุฎูู ูุจุงุฆุน - ุฅุฑุณุงู ุฑุณุงูุฉ
- [ ] ุชุณุฌูู ุฏุฎูู ูุฃุฏูู - ุฅุฑุณุงู ุฑุณุงูุฉ

### ุงุฎุชุจุงุฑ 2: ุนุฑุถ ุงููุญุงุฏุซุงุช
- [ ] ุงูุนููู ูุฑู ูุญุงุฏุซุงุชู ููุท (ูุง ูุฑู ูุญุงุฏุซุงุช ุงูุขุฎุฑูู)
- [ ] ุงูุจุงุฆุน ูุฑู ูุญุงุฏุซุงุช ูุชุฌุฑู ููุท
- [ ] ุงูุฃุฏูู ูุฑู ูู ุงููุญุงุฏุซุงุช

### ุงุฎุชุจุงุฑ 3: Emoji Picker
- [ ] ูุชุญ Emoji Picker
- [ ] ุฅุถุงูุฉ emoji ููุฑุณุงูุฉ
- [ ] ุฅุบูุงู Picker ุจุงูุถุบุท ุฎุงุฑุฌู
- [ ] ุฅุฑุณุงู ุฑุณุงูุฉ ูุน emoji

### ุงุฎุชุจุงุฑ 4: ุงูุชุญุฏูุซ ุงูุชููุงุฆู
- [ ] ูุชุญ ูุญุงุฏุซุฉ ูู ูุงูุฐุชูู ูุฎุชููุชูู
- [ ] ุฅุฑุณุงู ุฑุณุงูุฉ ูู ุงููุงูุฐุฉ ุงูุฃููู
- [ ] ุงูุชุฃูุฏ ูู ุธููุฑูุง ูู ุงููุงูุฐุฉ ุงูุซุงููุฉ ุจุฏูู ุชุญุฏูุซ ูุงูู

---

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ูุจู ุงูุฅุตูุงุญ:
- โ ููุท ุงูุนููู ููููู ุฅูุดุงุก ูุญุงุฏุซุฉ
- โ ุงููุญุงุฏุซุงุช ุชุธูุฑ ููุฌููุน ุจุฏูู ููุชุฑุฉ
- โ ุงูุชุญุฏูุซ ุงููุณุชูุฑ ูุณุจุจ ุจุทุก
- โ ูุง ููุฌุฏ emoji picker

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ุฌููุน ุงูุฃุฏูุงุฑ ูููููุง ุฅูุดุงุก ูุญุงุฏุซุงุช ูุฅุฑุณุงู ุฑุณุงุฆู
- โ ูู ูุณุชุฎุฏู ูุฑู ูุญุงุฏุซุงุชู ููุท (ูุซู ูุงุชุณุงุจ)
- โ ุชุญุฏูุซุงุช Real-time ูุญุณููุฉ ูุณูุณุฉ
- โ Emoji Picker ูุฏูุฌ ุจุงููุงูู

---

## ๐ ุงููุฑุงุฌุน

- [Supabase RLS Documentation](https://supabase.com/docs/guides/auth/row-level-security)
- [emoji-picker-react](https://www.npmjs.com/package/emoji-picker-react)
- [Realtime Subscriptions](https://supabase.com/docs/guides/realtime)

---

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ ุงูููุชุฑุญุฉ

1. **ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช Push** ููุฑุณุงุฆู ุงูุฌุฏูุฏุฉ
2. **ุฑูุน ูููุงุช ููุณุงุฆุท** ูู ุงูุฑุณุงุฆู
3. **ุฑุณุงุฆู ุตูุชูุฉ**
4. **ุญุงูุฉ "ููุชุจ..."** (typing indicator)
5. **ุนูุงูุงุช ุงูุชุณููู ูุงููุฑุงุกุฉ** (double check marks)
6. **ุงูุจุญุซ ูู ุงูุฑุณุงุฆู**
7. **ุชุซุจูุช ุงููุญุงุฏุซุงุช ุงููููุฉ**

---

ุชู ุจูุฌุงุญ! ๐
