# ๐งช ุงุฎุชุจุงุฑ ูุธุงู ุงููุญูุธุฉ - Wallet System Testing Guide

## โ ุชู ุงูุชุดุบูู ุจูุฌุงุญ!

ุงูุณูุฑูุจุช [create-wallet-system.sql](create-wallet-system.sql) ุชู ุชูููุฐู ุจูุฌุงุญ ูุชู ุฅูุดุงุก:
- โ ุฌุฏูู `wallet_transactions` - ูููุนุงููุงุช
- โ ุฌุฏูู `payout_requests` - ูุทูุจุงุช ุงูุณุญุจ
- โ Trigger `update_vendor_wallet` - ููุชุญุฏูุซ ุงูุชููุงุฆู
- โ ุชููุฆุฉ ุงูุฃุฑุตุฏุฉ ูู ุงูุทูุจุงุช ุงูุญุงููุฉ

---

## ๐ ุฎุทูุงุช ุงูุชุญูู

### 1. ูุญุต ุฃุฑุตุฏุฉ ุงููุญุงูุธ

ุดุบูู ูุฐุง ุงูุณูุฑูุจุช ูู Supabase SQL Editor:
```bash
database/verify-wallet-system.sql
```

ูุฌุจ ุฃู ุชุฑู:
- **ุงูุฑุตูุฏ ุงููุนูู (pending_balance)**: ูู ุงูุทูุจุงุช ุงููุคูุฏุฉ (confirmed, preparing, ready_for_pickup, picked_up, in_transit)
- **ุงูุฑุตูุฏ ุงูุญุงูู (current_balance)**: ูู ุงูุทูุจุงุช ุงูููุชููุฉ (completed)
- **ุฅุฌูุงูู ุงูุฃุฑุจุงุญ (total_earned)**: ูุฌููุน ูู ุงูุฃุฑุจุงุญ

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### Test Case 1: ุชุฃููุฏ ุทูุจ ุฌุฏูุฏ

1. ุงุฐูุจ ูุตูุญุฉ ุงูุทูุจุงุช ูู ููุญุฉ ุชุญูู ุงูุจุงุฆุน
2. ุงุถุบุท ุนูู "ุชุฃููุฏ ุงูุทูุจ" ูุทูุจ ุฌุฏูุฏ
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
   - ูุชู ุฅุถุงูุฉ ุงููุจูุบ ุฅูู "ุงูุฑุตูุฏ ุงููุนูู" ูู ุตูุญุฉ ุงููุญูุธุฉ
   - ูุธูุฑ ุณุฌู ุฌุฏูุฏ ูู "ุงููุนุงููุงุช" ุจููุน "earning" ูุญุงูุฉ "pending"

**ููููุฉ ุงูุชุญูู:**
```sql
-- ุดุงูุฏ ุขุฎุฑ ูุนุงููุฉ
SELECT * FROM wallet_transactions 
ORDER BY created_at DESC LIMIT 1;

-- ุดุงูุฏ ุงูุฑุตูุฏ ุงููุนูู
SELECT pending_balance FROM vendor_wallets 
WHERE vendor_id = 'YOUR_VENDOR_ID';
```

---

### Test Case 2: ุฅููุงู ุทูุจ

1. ุบููุฑ ุญุงูุฉ ุทูุจ ูู "ุฌุงูุฒ ููุงุณุชูุงู" ุฅูู "ููุชูู"
2. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
   - ููุชูู ุงููุจูุบ ูู "ุงูุฑุตูุฏ ุงููุนูู" ุฅูู "ุงูุฑุตูุฏ ุงูุญุงูู"
   - ูุชุญุฏุซ ุณุฌู ุงููุนุงููุฉ ูู "pending" ุฅูู "completed"

**ููููุฉ ุงูุชุญูู:**
```sql
-- ุดุงูุฏ ุงูุชุบููุฑ ูู ุงูุฃุฑุตุฏุฉ
SELECT 
  pending_balance, 
  current_balance, 
  total_earned 
FROM vendor_wallets 
WHERE vendor_id = 'YOUR_VENDOR_ID';
```

---

### Test Case 3: ุฅูุบุงุก ุทูุจ

1. ุงูุบู ุทูุจ ูุคูุฏ
2. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
   - ููุญุฐู ุงููุจูุบ ูู "ุงูุฑุตูุฏ ุงููุนูู"
   - ูุชุญุฏุซ ุณุฌู ุงููุนุงููุฉ ุฅูู "cancelled"

---

### Test Case 4: ุทูุจ ุณุญุจ

1. ุงุฐูุจ ูุตูุญุฉ ุงููุญูุธุฉ
2. ุงุถุบุท ุนูู "ุทูุจ ุณุญุจ"
3. ุฃุฏุฎู ุงููุจูุบ ูุจูุงูุงุช ุงูุจูู
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
   - ูุชู ุฅูุดุงุก ุณุฌู ูู `payout_requests` ุจุญุงูุฉ "pending"
   - ูุธูุฑ ุงูุทูุจ ูู ูุงุฆูุฉ "ุทูุจุงุช ุงูุณุญุจ"

---

## ๐ ูุนุงุฏูุฉ ุญุณุงุจ ุงูุฃุฑุจุงุญ

```
ุฅุฌูุงูู ุงูุทูุจ = 100 ุฑูุงู
ุนูููุฉ ุงูููุตุฉ (10%) = 10 ุฑูุงู
ุฃุฑุจุงุญ ุงูุจุงุฆุน (90%) = 90 ุฑูุงู
```

ุงูู Trigger ูุญุณุจ ุชููุงุฆูุงู:
```sql
v_vendor_earning := v_order_total * (1 - v_commission_rate / 100)
-- 100 * (1 - 10/100) = 100 * 0.9 = 90
```

---

## ๐ ุฏูุฑุฉ ุญูุงุฉ ุงูุทูุจ ูุงููุญูุธุฉ

| ุญุงูุฉ ุงูุทูุจ | ุงูุชุฃุซูุฑ ุนูู ุงููุญูุธุฉ |
|------------|---------------------|
| `pending` | ูุง ุดูุก |
| `confirmed` | โ ููุถุงู ููุฑุตูุฏ ุงููุนูู |
| `preparing` | ูุง ุชุบููุฑ |
| `ready_for_pickup` | ูุง ุชุบููุฑ |
| `picked_up` | ูุง ุชุบููุฑ |
| `in_transit` | ูุง ุชุบููุฑ |
| `completed` | โ ููุชูู ููุฑุตูุฏ ุงูุญุงูู |
| `cancelled` | โ ููุญุฐู ูู ุงูุฑุตูุฏ ุงููุนูู |
| `refunded` | โ ููุญุฐู ูู ุงูุฑุตูุฏ ุงููุนูู |

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุฑุตูุฏ ุงููุนูู = 0
**ุงูุญู:** 
- ุชุฃูุฏ ูู ูุฌูุฏ ุทูุจุงุช ุจุญุงูุฉ `confirmed` ุฃู ูุง ุจุนุฏูุง
- ุดุบูู:
```sql
SELECT COUNT(*), status 
FROM orders 
WHERE vendor_id = 'YOUR_VENDOR_ID'
GROUP BY status;
```

### ุงููุดููุฉ: ูุง ุชุธูุฑ ูุนุงููุงุช
**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู ุงูู Trigger ูุนูู:
```sql
SELECT * FROM pg_trigger 
WHERE tgname = 'trigger_update_vendor_wallet';
```

### ุงููุดููุฉ: ุงูุฃุฑูุงู ูุง ุชุชุทุงุจู
**ุงูุญู:**
- ุดุบูู ุณูุฑููพุช ุฅุนุงุฏุฉ ุงูุชููุฆุฉ (ุงูุฌุฒุก ุงูุฎุงูุณ ูู create-wallet-system.sql)

---

## ๐ฑ ุงูุงุฎุชุจุงุฑ ูู ุงููุงุฌูุฉ

### ูู ุตูุญุฉ ุงููุญูุธุฉ ูุฌุจ ุฃู ุชุฑู:

**ุงูุจุทุงูุงุช ุงูุนูููุฉ:**
- ๐ฐ ุงูุฑุตูุฏ ุงูุญุงูู: ุงููุจูุบ ุงููุชุงุญ ููุณุญุจ
- โณ ุงูุฑุตูุฏ ุงููุนูู: ุงูุทูุจุงุช ุงููุคูุฏุฉ ููู ุบูุฑ ููุชููุฉ
- ๐ ุฅุฌูุงูู ุงูุฃุฑุจุงุญ: ูู ูุง ุฑุจุญุชู
- ๐ธ ุงููุณุญูุจุงุช: ุงููุจุงูุบ ุงููุณุญูุจุฉ

**ุฌุฏูู ุงููุนุงููุงุช:**
- ุฃุฑุจุงุญ ูู ุงูุทูุจุงุช
- ุนูููุงุช ุงูุณุญุจ
- ุงููุฑุชุฌุนุงุช

**ุฌุฏูู ุทูุจุงุช ุงูุณุญุจ:**
- ุงูุทูุจุงุช ุงููุนููุฉ
- ุงูุทูุจุงุช ุงูููุชููุฉ
- ุงูุทูุจุงุช ุงููุฑููุถุฉ

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

- [ ] ุงูุณูุฑูุจุช ุชู ุชุดุบููู ุจูุฌุงุญ โ (ููุชูู)
- [ ] ุงูุฃุฑุตุฏุฉ ุชุธูุฑ ูู ุตูุญุฉ ุงููุญูุธุฉ
- [ ] ุงููุนุงููุงุช ุชุธูุฑ ูู ุงูุฌุฏูู
- [ ] ุชุฃููุฏ ุทูุจ ุฌุฏูุฏ ูุฒูุฏ ุงูุฑุตูุฏ ุงููุนูู
- [ ] ุฅููุงู ุทูุจ ูููู ุงูุฑุตูุฏ ููุฑุตูุฏ ุงูุญุงูู
- [ ] ุฅูุบุงุก ุทูุจ ูุญุฐู ูู ุงูุฑุตูุฏ ุงููุนูู
- [ ] ุทูุจ ุงูุณุญุจ ูุนูู ุจุฏูู ุฃุฎุทุงุก

---

## ๐ ุงูุฎุทูุฉ ุงูุชุงููุฉ

1. โ ุชู ุชุดุบูู create-wallet-system.sql
2. ๐ ุดุบูู verify-wallet-system.sql ููุชุญูู
3. ๐งช ุงุฎุชุจุฑ ูู ุงููุงุฌูุฉ (ุชุฃููุฏ/ุฅููุงู ุทูุจ)
4. ๐ค ุงูุดุฑ ุงูุชุทุจูู: `git push origin main`

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ุนูููุฉ ุงูููุตุฉ
ุงูุนูููุฉ ุงูุญุงููุฉ: **10%** ูู ูู ุทูุจ

ูุชุบููุฑูุงุ ุนุฏูู ุงูุณุทุฑ 90 ูู [create-wallet-system.sql](create-wallet-system.sql):
```sql
v_commission_rate DECIMAL(5, 2) := 10.00; -- ุบููุฑ ุงูุฑูู ููุง
```

### ุงูุฃูุงู
- โ RLS ููุนูู ุนูู ุฌููุน ุงูุฌุฏุงูู
- โ ูู ุจุงุฆุน ูุฑู ูุนุงููุงุชู ููุท
- โ ุตูุงุญูุงุช INSERT/SELECT ูุญุฏุฏุฉ ุจุฏูุฉ

### ุงูุฃุฏุงุก
- โ Indexes ุนูู vendor_id ู order_id ู created_at
- โ Trigger ูุนูู ููุท ุนูุฏ UPDATE (ููุณ INSERT)
- โ Queries ูุญุณููุฉ ููุณุฑุนุฉ
