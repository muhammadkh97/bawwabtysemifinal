# ๐ ุฏููู ุชูููุฐ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงูุชุฑุชูุจ
# SQL Execution Order Guide

> **ุงูุชุงุฑูุฎ:** 25 ุฏูุณูุจุฑ 2025  
> **ุงูุฅุตุฏุงุฑ:** 2.0 - ุงูุจููุฉ ุงููุนูุงุฑูุฉ ุงูุฌุฏูุฏุฉ

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุนุงุฏุฉ ููููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู 5 ูููุงุช ูุจูุฑุฉ ุฅูู **12 ููู ูุนูุงุฑู** ูุณูููุฉ ุงูุฅุฏุงุฑุฉ ูุงูุตูุงูุฉ.

### โ ุงููููุงุช ุงูุฌุฏูุฏุฉ (ูุฌุจ ุชูููุฐูุง ุจุงูุชุฑุชูุจ)

| # | ุงุณู ุงูููู | ุงููุตู | ุงูููุช ุงููุชููุน |
|---|-----------|-------|---------------|
| 1 | `01-main-schema.sql` | ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ (ุงููุณุชุฎุฏูููุ ุงูุจุงุฆุนููุ ุงูููุงุฏูุจุ ุงูุนูุงููู) | 2-3 ุฏูุงุฆู |
| 2 | `02-orders-delivery.sql` | ูุธุงู ุงูุทูุจุงุช ูุงูุชูุตูู | 2 ุฏูุงุฆู |
| 3 | `03-financial-system.sql` | ุงููุธุงู ุงููุงูู (ุงููุญุงูุธุ ุงููุนุงููุงุชุ ุงูุณุญูุจุงุช) | 2 ุฏูุงุฆู |
| 4 | `04-marketing-loyalty.sql` | ุงูุชุณููู ูุงูููุงุก (ุงูููุจููุงุชุ ุงูููุงุทุ ุงูุนุฑูุถ) | 2 ุฏูุงุฆู |
| 5 | `05-communication-support.sql` | ุงูุชูุงุตู ูุงูุฏุนู (ุงูุฑุณุงุฆูุ ุงูุชุฐุงูุฑุ ุงููุฒุงุนุงุช) | 2 ุฏูุงุฆู |
| 6 | `06-system-settings.sql` | ุฅุนุฏุงุฏุงุช ุงููุธุงู ูุงูุณุฌูุงุช | 1 ุฏูููุฉ |
| 7 | `07-functions-triggers.sql` | ุงูุฏูุงู ูุงููุญูุฒุงุช ุงูุชููุงุฆูุฉ | 3 ุฏูุงุฆู |
| 8 | `08-notification-triggers.sql` | ูุธุงู ุงูุฅุดุนุงุฑุงุช | 2 ุฏูุงุฆู |
| 9 | `09-rls-policies.sql` | ุณูุงุณุงุช ุงูุฃูุงู (Row Level Security) | 3-4 ุฏูุงุฆู |
| 10 | `10-storage-setup.sql` | ุฅุนุฏุงุฏ ุงูุชุฎุฒูู ุงูุณุญุงุจู | 1 ุฏูููุฉ |
| 11 | `11-initial-data.sql` | ุงูุจูุงูุงุช ุงูุฃูููุฉ (ุงููุฆุงุชุ ุงูุฅุนุฏุงุฏุงุช) | 1 ุฏูููุฉ |
| 12 | `12-views-indexes.sql` | Views ูุงูููุงุฑุณ ุงููุชูุฏูุฉ | 2-3 ุฏูุงุฆู |

**โฑ๏ธ ุฅุฌูุงูู ุงูููุช:** 22-28 ุฏูููุฉ ุชูุฑูุจุงู

---

## ๐ ุฎุทูุงุช ุงูุชูููุฐ

### ุงูุฎุทูุฉ 1๏ธโฃ: ุงูุฏุฎูู ุฅูู Supabase Dashboard

1. ุงูุชุญ: https://supabase.com/dashboard
2. ุงุฎุชุฑ ูุดุฑูุนู: **bawwabtyM**
3. ุงูุชูู ุฅูู: **SQL Editor** ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ

---

### ุงูุฎุทูุฉ 2๏ธโฃ: ุชูููุฐ ุงููููุงุช ุจุงูุชุฑุชูุจ

> โ๏ธ **ููู ุฌุฏุงู:** ููุฐ ุงููููุงุช ุจุงูุชุฑุชูุจ ุงููุญุฏุฏุ ูุง ุชููุฒ ุจูู ุงููููุงุช!

#### ููู 1: ุงูุจููุฉ ุงูุฃุณุงุณูุฉ
```bash
ุงูููู: 01-main-schema.sql
```
1. ุงูุชุญ ุงูููู ูู VS Code
2. ุงูุณุฎ ุงููุญุชูู ุจุงููุงูู (`Ctrl + A` ุซู `Ctrl + C`)
3. ุงูุตู ูู Supabase SQL Editor (`Ctrl + V`)
4. ุงุถุบุท **RUN** ุฃู `F5`
5. โ ุงูุชุธุฑ ุฑุณุงูุฉ "Success" ูุจู ุงููุชุงุจุนุฉ

#### ููู 2: ุงูุทูุจุงุช ูุงูุชูุตูู
```bash
ุงูููู: 02-orders-delivery.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช ุงูุณุงุจูุฉ

#### ููู 3: ุงููุธุงู ุงููุงูู
```bash
ุงูููู: 03-financial-system.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

#### ููู 4: ุงูุชุณููู ูุงูููุงุก
```bash
ุงูููู: 04-marketing-loyalty.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

#### ููู 5: ุงูุชูุงุตู ูุงูุฏุนู
```bash
ุงูููู: 05-communication-support.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

#### ููู 6: ุฅุนุฏุงุฏุงุช ุงููุธุงู
```bash
ุงูููู: 06-system-settings.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

#### ููู 7: ุงูุฏูุงู ูุงููุญูุฒุงุช
```bash
ุงูููู: 07-functions-triggers.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

#### ููู 8: ูุญูุฒุงุช ุงูุฅุดุนุงุฑุงุช
```bash
ุงูููู: 08-notification-triggers.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

#### ููู 9: ุณูุงุณุงุช ุงูุฃูุงู (RLS)
```bash
ุงูููู: 09-rls-policies.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

#### ููู 10: ุงูุชุฎุฒูู ุงูุณุญุงุจู
```bash
ุงูููู: 10-storage-setup.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

#### ููู 11: ุงูุจูุงูุงุช ุงูุฃูููุฉ
```bash
ุงูููู: 11-initial-data.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

#### ููู 12: Views ูุงูููุงุฑุณ
```bash
ุงูููู: 12-views-indexes.sql
```
ูุฑุฑ ููุณ ุงูุฎุทูุงุช

---

### ุงูุฎุทูุฉ 3๏ธโฃ: ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุนุฏุงุฏ

ููุฐ ูุฐุง ุงูุงุณุชุนูุงู ูู SQL Editor ููุชุฃูุฏ:

```sql
-- ุงูุชุญูู ูู ุงูุฌุฏุงูู
SELECT 
    schemaname,
    tablename,
    tableowner
FROM pg_tables 
WHERE schemaname = 'public'
ORDER BY tablename;

-- ูุฌุจ ุฃู ุชุธูุฑ 50+ ุฌุฏูู
```

### ุงุฎุชุจุงุฑ ุงูุฏูุงู:

```sql
-- ุงุฎุชุจุงุฑ ุฏุงูุฉ ุชูููุฏ ุฑูู ุทูุจ
SELECT generate_order_number();

-- ุงุฎุชุจุงุฑ ุฏุงูุฉ ุชูููุฏ ููุจูู
SELECT generate_coupon_code(8);
```

### ุงูุชุญูู ูู RLS:

```sql
-- ุงูุชุญูู ูู ุชูุนูู RLS
SELECT 
    schemaname,
    tablename,
    rowsecurity
FROM pg_tables 
WHERE schemaname = 'public' 
  AND rowsecurity = true;
```

---

## ๐๏ธ ุญุฐู ุงููููุงุช ุงููุฏููุฉ

ุจุนุฏ ุงูุชุฃูุฏ ูู ูุฌุงุญ ุงูุชูููุฐุ ุงุญุฐู ุงููููุงุช ุงููุฏููุฉ:

### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู ุงูุณูุฑูุจุช (ููุตู ุจู)

```powershell
.\remove-old-files.ps1
```

### ุงูุทุฑููุฉ 2: ูุฏููุงู

ุงุญุฐู ูุฐู ุงููููุงุช:
- โ `supabase-schema.sql`
- โ `supabase-complete-setup.sql`
- โ `supabase-advanced-features.sql`
- โ `supabase-storage-setup.sql`
- โ `SETUP_DATABASE.sql`

---

## ๐ง ูู ุญุงู ุญุฏูุซ ุฎุทุฃ

### ุฎุทุฃ: "relation already exists"
```sql
-- ุญู: ุฃุถู IF NOT EXISTS (ููุฌูุฏ ุจุงููุนู ูู ุงููููุงุช ุงูุฌุฏูุฏุฉ)
CREATE TABLE IF NOT EXISTS ...
```

### ุฎุทุฃ: "must be owner of table"
- ุชุฃูุฏ ุฃูู ูุณุฌู ุฏุฎูู ููุงูู ุงููุดุฑูุน ูู Supabase

### ุฎุทุฃ: "function does not exist"
- ุชุฃูุฏ ุฃูู ููุฐุช ููู `07-functions-triggers.sql` ูุจู ุงููููุงุช ุงูุชู ุชุนุชูุฏ ุนููู

---

## ๐ ูุง ุงูุฌุฏูุฏ ูู ุงูุฅุตุฏุงุฑ 2.0ุ

### โจ ุงูุชุญุณููุงุช

1. **ุจููุฉ ูุนูุงุฑูุฉ:**
   - ุชูุณูู ููุทูู ูููููุงุช
   - ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุญุฏูุซ
   - ุฅููุงููุฉ ุชุดุบูู ุฃุฌุฒุงุก ูุญุฏุฏุฉ ููุท

2. **ุฃูุงู ูุญุณูู:**
   - RLS ุดุงูู ูุฌููุน ุงูุฌุฏุงูู
   - ุณูุงุณุงุช ุฏูููุฉ ููู ุฏูุฑ ูุณุชุฎุฏู
   - ุญูุงูุฉ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ

3. **ูุธุงู ูุงูู ูุชูุฏู:**
   - ูุญุงูุธ ุฑูููุฉ
   - ุชุชุจุน ุงููุนุงููุงุช
   - ูุธุงู ุณุญูุจุงุช ุขูู
   - ุญุณุงุจ ุงูุนูููุงุช ุชููุงุฆูุงู

4. **ูุธุงู ููุงุก ูุชุทูุฑ:**
   - ููุงุท ุงูููุงุก ุงูุชููุงุฆูุฉ
   - ูุณุชููุงุช ุงูุนุถููุฉ
   - ููุงูุขุช ุงูุฅุญุงูุฉ
   - ุนุฑูุถ ุฎุงุตุฉ

5. **ุฅุดุนุงุฑุงุช ุฐููุฉ:**
   - ูุญูุฒุงุช ุชููุงุฆูุฉ
   - ุฅุดุนุงุฑุงุช ููุฑูุฉ
   - ุจุฑูุฏ ุฅููุชุฑููู
   - SMS (ุฌุงูุฒ ููุชูุงูู)

6. **ุฃุฏุงุก ูุญุณูู:**
   - ููุงุฑุณ ูุชูุฏูุฉ
   - Materialized Views
   - ุงุณุชุนูุงูุงุช ูุญุณููุฉ
   - Caching

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ๏ธ ุชุญุฐูุฑุงุช

1. **ูุง ุชููุฐ ุงููููุงุช ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ ูุนุงู** - ูุฏ ูุณุจุจ ุชุนุงุฑุถุงุช
2. **ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ** ูุจู ุชูููุฐ ุฃู ุชุบููุฑุงุช
3. **ุงุฎุชุจุฑ ูู ุจูุฆุฉ ุชุทููุฑ ุฃููุงู** ูุจู ุงูุฅูุชุงุฌ

### ๐ก ูุตุงุฆุญ

1. ููุฐ ุงููููุงุช ูู ููุช ูุงุฏุฆ (ููุฉ ุงููุณุชุฎุฏููู)
2. ุฑุงูุจ ุงูุฃุฎุทุงุก ูู Console
3. ุงุฎุชุจุฑ ูู ูุธููุฉ ุจุนุฏ ุงูุชูููุฐ
4. ูุซูู ุฃู ุชุบููุฑุงุช ุฅุถุงููุฉ

---

## ๐ ุงูุฏุนู

ูู ุญุงู ูุงุฌูุช ุฃู ูุดููุฉ:

1. ุชุญูู ูู ุณุฌู ุงูุฃุฎุทุงุก ูู SQL Editor
2. ุฑุงุฌุน ุงูููู ุงูุฐู ุณุจุจ ุงููุดููุฉ
3. ุชุฃูุฏ ูู ุชูููุฐ ุงููููุงุช ุจุงูุชุฑุชูุจ ุงูุตุญูุญ
4. ุชุญูู ูู ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

- [ ] ุชู ุชูููุฐ ุฌููุน ุงูู 12 ููู ุจูุฌุงุญ
- [ ] ุชู ุงูุชุญูู ูู ูุฌูุฏ ุฌููุน ุงูุฌุฏุงูู
- [ ] ุชู ุงุฎุชุจุงุฑ ุงูุฏูุงู ุงูุฃุณุงุณูุฉ
- [ ] ุชู ุงูุชุญูู ูู ุชูุนูู RLS
- [ ] ุชู ุญุฐู ุงููููุงุช ุงููุฏููุฉ
- [ ] ุชู ุงุฎุชุจุงุฑ ุงูุชุทุจูู ูุงูุชุฃูุฏ ูู ุนููู
- [ ] ุชู ุนูู Git Commit ููุชุบููุฑุงุช

---

## ๐ ููุฒุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑูุฉ)

### 13. Product Variants System (ูุธุงู ูุชุบูุฑุงุช ุงูููุชุฌุงุช)

**ุงูููู:** `database/ADD_PRODUCT_VARIANTS.sql`

**ุงููุตู:** ุฅุถุงูุฉ ุฏุนู ุงููุชุบูุฑุงุช ููููุชุฌุงุช (ููุงุณุงุช ูุฃููุงู ูุฎุชููุฉ ุจุฃุณุนุงุฑ ูููุตูุฉ)

**ูุชู ุชุญุชุงุฌู:**
- ุฅุฐุง ููุช ุชุจูุน ููุชุฌุงุช ุจููุงุณุงุช ูุฎุชููุฉ (S, M, L, XL)
- ุฅุฐุง ููุช ุชุจูุน ููุชุฌุงุช ุจุฃููุงู ูุฎุชููุฉ ุจุฃุณุนุงุฑ ูุฎุชููุฉ
- ุฅุฐุง ูุงู ูุฏูู SKU ูููุตู ููู ูุชุบูุฑ

**ูุง ูุถููู:**
- ุนููุฏ `has_variants` (BOOLEAN) ูุฌุฏูู products
- ุนููุฏ `variants` (JSONB) ูุญูุธ ุงููุชุบูุฑุงุช
- ุฏุงูุฉ `get_variant_price()` ููุญุตูู ุนูู ุณุนุฑ ูุชุบูุฑ ูุญุฏุฏ
- ุฏุงูุฉ `get_variant_stock()` ููุญุตูู ุนูู ูุฎุฒูู ูุชุบูุฑ ูุญุฏุฏ
- ุฏุงูุฉ `update_variant_stock()` ูุชุญุฏูุซ ุงููุฎุฒูู
- ุฏุงูุฉ `check_variant_availability()` ููุชุญูู ูู ุงูุชููุฑ
- Trigger ุชููุงุฆู ูุชุญุฏูุซ ุฅุฌูุงูู ุงููุฎุฒูู
- View `v_products_with_variants` ูุนุฑุถ ุงูููุชุฌุงุช ูุน ูุทุงู ุงูุฃุณุนุงุฑ

**ุฎุทูุงุช ุงูุชูููุฐ:**

1. ุงูุชุญ: `database/ADD_PRODUCT_VARIANTS.sql`
2. ุงูุณุฎ ุงููุญุชูู ุจุงููุงูู
3. ุงูุตู ูู Supabase SQL Editor
4. ุงุถุบุท **RUN**
5. โ ุงูุชุธุฑ ุฑุณุงูุฉ "Success"

**ุงุฎุชุจุงุฑ ุงูููุฒุฉ:**

```sql
-- ุงูุชุญูู ูู ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'products' 
  AND column_name IN ('has_variants', 'variants');

-- ุงุฎุชุจุงุฑ ุงูุฏูุงู
SELECT get_variant_price('product_uuid', 'variant_id');
```

**ุงูุงุณุชุฎุฏุงู:**

ูููุฒูุฏ ูู ุงูุชูุงุตููุ ุฑุงุฌุน: [PRODUCT_VARIANTS_GUIDE.md](../../PRODUCT_VARIANTS_GUIDE.md)

---

**๐ ูุจุฑูู! ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌุงูุฒุฉ ุงูุขู!**
