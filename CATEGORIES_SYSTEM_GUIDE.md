# ๐ฏ ุชุทููุฑ ูุธุงู ุงูุชุตูููุงุช - ุฏููู ุงูุฅุตูุงุญ

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1๏ธโฃ ุฅุถุงูุฉ ุฑุงุจุท ุงูุชุตูููุงุช ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ โ
ุงูุฑุงุจุท ููุฌูุฏ ุจุงููุนู ูู [AdminSidebar.tsx](components/AdminSidebar.tsx#L93-L96)

### 2๏ธโฃ ุฅูุดุงุก ุตูุญุฉ ุชุตูููุงุช ุงุญุชุฑุงููุฉ โ
ุชู ุฅูุดุงุก ุตูุญุฉ ุฌุฏูุฏุฉ ุชูุงููุง ุจููุฒุงุช ูุชูุฏูุฉ:

#### โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:
- **ูุธุงู ูุฑูู (ุฃุจ ูุงุจู)** ูุซู ููุฑุฏุจุฑูุณ ุชูุงููุง
- **ุนุฑุถ ุดุฌุฑู ูุงุจู ููุทู/ุงููุชุญ** ููุชุตูููุงุช ุงููุฑุนูุฉ
- **ุฅุญุตุงุฆูุงุช ูุจุงุดุฑุฉ** (ุฅุฌูุงูู ุงูุชุตูููุงุชุ ุงูุฑุฆูุณูุฉุ ุงููุฑุนูุฉุ ุงููุดุทุฉ)
- **ุจุญุซ ุฐูู** ูุนูู ุนูู ุฌููุน ุงููุณุชููุงุช
- **ูุงุฌูุฉ ุงุญุชุฑุงููุฉ** ูุน ุชุฃุซูุฑุงุช ุญุฑููุฉ
- **ุฏุนู ุงููุตู** ุจุงูุนุฑุจู ูุงูุฅูุฌููุฒู
- **ุฅุฏุงุฑุฉ ุงูุฃููููุงุช** ูุน ูุนุงููุฉ
- **ุชุฑุชูุจ ุงูุนุฑุถ** ูุงุจู ููุชุฎุตูุต
- **ุญุงูุฉ ุงููุดุงุท** (ูุดุท/ุบูุฑ ูุดุท)
- **ุญุฐู ุชุณูุณูู** ููุชุตูููุงุช ุงููุฑุนูุฉ

#### ๐จ ุงูุชุตููู:
- ุฃููุงู ูุชุฏุฑุฌุฉ ููุชุตูููุงุช ุงูุฑุฆูุณูุฉ
- ุจุทุงูุงุช ุฅุญุตุงุฆูุฉ ููููุฉ
- ุฃุฒุฑุงุฑ ุชูุงุนููุฉ ูุน ุชุฃุซูุฑุงุช hover
- Modal ููุจุซูุฉ ุจุชุตููู ุนุตุฑู
- ุฑููุฒ ุชูุถูุญูุฉ ููู ุฅุฌุฑุงุก

### 3๏ธโฃ ุฅุตูุงุญ ูุดููุฉ 403 (Permission Denied) โ๏ธ

## ๐ง ุฎุทูุงุช ุฅุตูุงุญ ุฎุทุฃ 403

ุงููุดููุฉ: `permission denied for table categories`

### ุงูุญู: ุชุทุจูู ุณูุงุณุงุช RLS ูู Supabase

#### ุงูุทุฑููุฉ ุงูุฃููู: ุนุจุฑ Supabase Dashboard (ููุตู ุจู)

1. **ุงูุชุญ Supabase Dashboard**
   - ุงุฐูุจ ุฅูู: https://app.supabase.com
   - ุงุฎุชุฑ ูุดุฑูุนู: `itptinhxsylzvfcpxwpl`

2. **ุงุฐูุจ ุฅูู SQL Editor**
   - ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ โ SQL Editor
   - ุงููุฑ "New Query"

3. **ุงูุณุฎ ูุงูุตู SQL ุงูุชุงูู**:

```sql
-- ุฅุตูุงุญ ุณูุงุณุงุช RLS ูุฌุฏูู ุงูุชุตูููุงุช
ALTER TABLE categories ENABLE ROW LEVEL SECURITY;

-- ุญุฐู ุฌููุน ุงูุณูุงุณุงุช ุงููุฏููุฉ
DROP POLICY IF EXISTS "allow_read_categories" ON categories;
DROP POLICY IF EXISTS "allow_admin_manage_categories" ON categories;
DROP POLICY IF EXISTS "categories_public_read" ON categories;
DROP POLICY IF EXISTS "categories_admin_all" ON categories;
DROP POLICY IF EXISTS "categories_vendor_read" ON categories;

-- 1. ุงูุณูุงุญ ูุฌููุน ุงููุณุชุฎุฏููู ุจูุฑุงุกุฉ ุงูุชุตูููุงุช ุงููุดุทุฉ
CREATE POLICY "categories_public_read"
ON categories
FOR SELECT
TO authenticated, anon
USING (is_active = true);

-- 2. ุงูุณูุงุญ ูููุฏุฑุงุก ุจูู ุงูุนูููุงุช ุนูู ุงูุชุตูููุงุช
CREATE POLICY "categories_admin_all"
ON categories
FOR ALL
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM users
    WHERE users.id = auth.uid()
    AND users.role = 'admin'
  )
)
WITH CHECK (
  EXISTS (
    SELECT 1 FROM users
    WHERE users.id = auth.uid()
    AND users.role = 'admin'
  )
);

-- 3. ุงูุณูุงุญ ููุจุงุฆุนูู ูุงููุทุงุนู ุจูุฑุงุกุฉ ุงูุชุตูููุงุช
CREATE POLICY "categories_vendor_read"
ON categories
FOR SELECT
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM users
    WHERE users.id = auth.uid()
    AND users.role IN ('vendor', 'restaurant')
  )
);
```

4. **ููุฐ ุงูุงุณุชุนูุงู**
   - ุงุถุบุท ุนูู ุฒุฑ "Run" ุฃู Ctrl+Enter
   - ุชุญูู ูู ุธููุฑ ุฑุณุงูุฉ "Success"

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุนุจุฑ Supabase CLI (ูููุทูุฑูู)

```bash
# ูู ุงููุฌูุฏ ุงูุฑุฆูุณู ูููุดุฑูุน
supabase db push --file supabase/migrations/fix_categories_rls.sql
```

## ๐งช ุงุฎุชุจุงุฑ ุงูุญู

ุจุนุฏ ุชุทุจูู ุงูุณูุงุณุงุช:

1. **ุงูุชุญ ุตูุญุฉ ุงูุชุตูููุงุช**
   ```
   http://localhost:3000/admin/categories
   ```

2. **ุฌุฑุจ ุฅุถุงูุฉ ุชุตููู ุฑุฆูุณู**
   - ุงููุฑ "ุฅุถุงูุฉ ุชุตููู ุฑุฆูุณู"
   - ุงููุฃ ุงูุจูุงูุงุช
   - ุงุถุบุท "ุญูุธ ุงูุชุบููุฑุงุช"
   - โ ูุฌุจ ุฃู ูุนูู ุจุฏูู ุฎุทุฃ

3. **ุฌุฑุจ ุฅุถุงูุฉ ุชุตููู ูุฑุนู**
   - ุงููุฑ ุฒุฑ + ุจุฌุงูุจ ุฃู ุชุตููู ุฑุฆูุณู
   - ุงููุฃ ุงูุจูุงูุงุช
   - ุงุถุบุท "ุญูุธ ุงูุชุบููุฑุงุช"
   - โ ูุฌุจ ุฃู ูุธูุฑ ุชุญุช ุงูุชุตููู ุงูุฑุฆูุณู

## ๐ ุงููููุงุช ุงููููุฉ

### ุงููููุงุช ุงูุชู ุชู ุฅูุดุงุคูุง/ุชุนุฏูููุง:
1. **ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ**: `app/admin/categories/page.tsx`
2. **ุณูุงุณุงุช RLS**: `supabase/migrations/fix_categories_rls.sql`
3. **ุฏููู ุงูุฅุตูุงุญ**: `CATEGORIES_SYSTEM_GUIDE.md` (ูุฐุง ุงูููู)

### ุงููููุงุช ุฐุงุช ุงูุตูุฉ:
- `components/AdminSidebar.tsx` - ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ (ุงูุฑุงุจุท ููุฌูุฏ)
- `types/index.ts` - ุชุนุฑููุงุช TypeScript ููุชุตูููุงุช
- `lib/supabase.ts` - ุฅุนุฏุงุฏุงุช Supabase

## ๐ฏ ุงูููุฒุงุช ุงูุฅุถุงููุฉ ุงููุชููุฑุฉ

### ูู ุฌุฏูู categories:
```sql
- id (UUID)
- name (TEXT) - ุงูุงุณู ุจุงูุฅูุฌููุฒูุฉ
- name_ar (TEXT) - ุงูุงุณู ุจุงูุนุฑุจูุฉ
- slug (TEXT) - ุงูุฑุงุจุท ุงููุฑูุฏ
- description (TEXT) - ูุตู ุจุงูุฅูุฌููุฒูุฉ
- description_ar (TEXT) - ูุตู ุจุงูุนุฑุจูุฉ
- icon (TEXT) - ุงุณู ุงูุฃููููุฉ
- image_url (TEXT) - ุฑุงุจุท ุตูุฑุฉ ุงูุชุตููู
- parent_id (UUID) - ูุนุฑู ุงูุชุตููู ุงูุฃุจ
- level (INTEGER) - ูุณุชูู ุงูุชุตููู (0=ุฑุฆูุณูุ 1=ูุฑุนู)
- is_active (BOOLEAN) - ุญุงูุฉ ุงููุดุงุท
- display_order (INTEGER) - ุชุฑุชูุจ ุงูุนุฑุถ
- metadata (JSONB) - ุจูุงูุงุช ุฅุถุงููุฉ
- created_at - ุชุงุฑูุฎ ุงูุฅูุดุงุก
- updated_at - ุชุงุฑูุฎ ุงูุชุญุฏูุซ
```

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

1. โ **ุชุทุจูู ุณูุงุณุงุช RLS** (ุงูุฎุทูุฉ ุงูุญุงููุฉ)
2. ๐จ **ุชุฎุตูุต ุงูุฃููููุงุช** - ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุฎูุงุฑุงุช
3. ๐ธ **ุฑูุน ุงูุตูุฑ** - ุฏูุฌ ูุธุงู ุฑูุน ุงูุตูุฑ ููุชุตูููุงุช
4. ๐ **ุงูุณุญุจ ูุงูุฅููุงุช** - ูุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุชุตูููุงุช
5. ๐ **ุนุฏุงุฏ ุงูููุชุฌุงุช** - ุนุฑุถ ุนุฏุฏ ุงูููุชุฌุงุช ููู ุชุตููู
6. ๐ **ุชุนุฏุฏ ุงููุณุชููุงุช** - ุฏุนู ุฃูุซุฑ ูู ูุณุชูููู (ุญููุฏุ ุฅูุฎ)

## ๐ก ูุตุงุฆุญ ูููุฉ

### ูููุฏุฑุงุก:
- ููููู ุฅุถุงูุฉ ุชุตูููุงุช ุฑุฆูุณูุฉ ูุจุงุดุฑุฉ
- ูุฅุถุงูุฉ ุชุตููู ูุฑุนูุ ุงููุฑ ุฒุฑ + ุจุฌุงูุจ ุงูุชุตููู ุงูุฑุฆูุณู
- ุงุณุชุฎุฏู ุงูุจุญุซ ููุนุซูุฑ ุนูู ุชุตููู ูุนูู ุจุณุฑุนุฉ

### ูููุทูุฑูู:
- ุงูููุฏ ููุธู ููุนูู ุฌูุฏูุง
- ุงุณุชุฎุฏุงู TypeScript ููุฃูุงู ุงูููุนู
- ุงุณุชุฎุฏุงู Framer Motion ููุญุฑูุงุช ุงูุณูุณุฉ
- ุงูููุฏ ูุงุจู ููุชูุณุน ุจุณูููุฉ

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุงูุชุตูููุงุช
**ุงูุญู**: ุชุญูู ูู:
- ุชุณุฌูู ุงูุฏุฎูู ููุฏูุฑ
- ุชุทุจูู ุณูุงุณุงุช RLS ุจุดูู ุตุญูุญ
- ูุฌูุฏ ุจูุงูุงุช ูู ุฌุฏูู categories

### ุงููุดููุฉ: ุฎุทุฃ 403 ูุณุชูุฑ
**ุงูุญู**:
1. ุชุฃูุฏ ูู ุชุทุจูู ุณูุงุณุงุช RLS
2. ุชุญูู ูู ุฏูุฑ ุงููุณุชุฎุฏู ูู ุฌุฏูู users
3. ุงูุณุญ cache ุงููุชุตูุญ ูุฃุนุฏ ุชุญููู ุงูุตูุญุฉ

### ุงููุดููุฉ: ุงูุชุตูููุงุช ุงููุฑุนูุฉ ูุง ุชุธูุฑ
**ุงูุญู**: 
- ุชุฃูุฏ ูู ุฃู parent_id ูุดูุฑ ููุชุตููู ุงูุตุญูุญ
- ุงููุฑ ุนูู ุงูุณูู ููุชุญ/ุฅุบูุงู ุงูุชุตูููุงุช ุงููุฑุนูุฉ

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุฑุงุฌุน console ุงููุชุตูุญ ููุฃุฎุทุงุก
2. ุชุญูู ูู Supabase logs
3. ุชุฃูุฏ ูู ุชุทุจูู ุฌููุน ุงูุฎุทูุงุช ุงููุฐููุฑุฉ

---

**ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ**: GitHub Copilot
**ุงูุชุงุฑูุฎ**: 3 ููุงูุฑ 2026
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู (ุจุนุฏ ุชุทุจูู RLS)
