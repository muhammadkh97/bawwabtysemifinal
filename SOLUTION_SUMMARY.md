# ๐ฏ ููุฎุต ุงูุฅุตูุงุญ - ูุดููุฉ ุตูุญุฉ ุฅุถุงูุฉ ุงูููุชุฌ

## ุงููุดููุฉ โ
ุนูุฏ ุงูุถุบุท ุนูู "ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ"ุ ุงูุตูุญุฉ ุชุธูุฑ ุฑุณุงูุฉ "ุฌุงุฑู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช" ูุชุจูู ุชูู ุจูุง ุชููู.

---

## ุงูุณุจุจ ุงูุฌุฐุฑู ๐

### ุงูุณุจุจ #1: RLS Policies ุฎุงุทุฆุฉ
```
ุงูุณูุงุณุฉ ุงููุฏููุฉ:
- ุงูุจุงุฆุนูู ูุณุชุทูุนูู ููุท ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช ุงููุนุชูุฏุฉ (approved)
- ููู ุงูููุชุฌ ุงูุฌุฏูุฏ ูููู draft/pending
โ ุงูุฅุฏุฑุงุฌ ููุดู ุจู RLS error

ุงูุณูุงุณุฉ ุงูุฌุฏูุฏุฉ:
- ุงูุจุงุฆุนูู ูุฑูู ุฌููุน ููุชุฌุงุชูู (ุจุบุถ ุงููุธุฑ ุนู ุงูุญุงูุฉ)
- ูุณุชุทูุนูู ุงูุฅุฏุฑุงุฌ ูุงูุชุนุฏูู ูุงูุญุฐู
โ ูุนูู!
```

### ุงูุณุจุจ #2: ุนุฏู ูุฌูุฏ Timeout
```
ProtectedRoute ูุญุงูู ุฌูุจ ุงูุจูุงูุงุช ูู ุงูู database
ููู ูู ูุงู ุงูู connection ุจุทูุก ุฃู ูุนุทู
โ ุงูุตูุญุฉ ุชูุชุธุฑ ููุฃุจุฏ
โ ุงููุณุชุฎุฏู ูุฑู ุญููุฉ loading

ุงูุญู: ุฅุถุงูุฉ timeout 5 ุซูุงูู
โ ุจุนุฏ 5 ุซูุงูู: ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ
โ ุงููุณุชุฎุฏู ูุนุฑู ุฃู ููู ูุดููุฉ
```

### ุงูุณุจุจ #3: Error Handling ุถุนูู
```
ูู ุญุตู ุฎุทุฃ RLS ุฃู FK
โ ูุง ูุธูุฑ ุฑุณุงูุฉ ูุงุถุญุฉ ูููุณุชุฎุฏู
โ ุงูุตูุญุฉ ุชุจูู ุชุญููู

ุงูุญู: ุฑุณุงุฆู ุฎุทุฃ ูุญุฏุฏุฉ
- "ุฎุทุฃ ูู ุงูุตูุงุญูุงุช"
- "ูุฆุฉ ุงูููุชุฌ ุบูุฑ ุตุญูุญุฉ"
- "ุฎุทุฃ ูู ุงูุงุชุตุงู"
```

---

## ุงูุฅุตูุงุญ ุงููุทุจู โ

### 1๏ธโฃ ุชุญุฏูุซ RLS Policies
**ุงูููู:** `database/fix_product_rls_policies.sql`

```sql
-- ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ ุชููุฑ:

1. public_view_approved_products
   โ ุงูุนุงูุฉ ูุฑูู ุงูููุชุฌุงุช ุงููุนุชูุฏุฉ ููุท

2. vendor_view_own_products
   โ ุงูุจุงุฆุนูู ูุฑูู ููุชุฌุงุชูู (ุจุฃู ุญุงูุฉ)

3. vendor_insert_products
   โ ุงูุจุงุฆุนูู ููุฏุฑูู ูุถูููุง ููุชุฌุงุช

4. vendor_update_own_products
   โ ุงูุจุงุฆุนูู ููุฏุฑูู ูุนุฏูููุง ููุชุฌุงุชูู

5. vendor_delete_own_products
   โ ุงูุจุงุฆุนูู ููุฏุฑูู ูุญุฐููุง ููุชุฌุงุชูู

6. admin_manage_all_products
   โ ุงููุณุคูููู ูุฏููุฑูู ุงููู
```

### 2๏ธโฃ ุฅุถุงูุฉ Timeout
**ุงููููุงุช:**
- `components/ProtectedRoute.tsx`
- `contexts/AuthContext.tsx`
- `app/dashboard/vendor/products/new/page.tsx`

```typescript
// ูุซุงู:
const timeoutPromise = new Promise((_, reject) =>
  setTimeout(() => reject(new Error('Timeout')), 5000)
);

const { data } = await Promise.race([
  fetchPromise,
  timeoutPromise
]);
```

### 3๏ธโฃ Better Error Messages
**ุงูููู:** `app/dashboard/vendor/products/new/page.tsx`

```typescript
if (error.message.includes('new row violates row-level security')) {
  toast.error('โ ุฎุทุฃ ูู ุงูุตูุงุญูุงุช: ุชุฃูุฏ ูู ุฃูู ูุณุฌู ุฏุฎูู ูุจุงุฆุน');
} else if (error.message.includes('violates foreign key')) {
  toast.error('โ ุฎุทุฃ: ุชุฃูุฏ ูู ุงุฎุชูุงุฑ ูุฆุฉ ุตุญูุญุฉ');
} else {
  toast.error(`โ ุฎุทุฃ ูู ุญูุธ ุงูููุชุฌ: ${error.message}`);
}
```

---

## ุงูุฎุทูุงุช ุงููุทููุจุฉ

### ุงูุฎุทูุฉ 1: ุชุทุจูู SQL (ุถุฑูุฑู ุฌุฏุงู!) โ๏ธ

```
1. ุงุฐูุจ ุฅูู: https://supabase.com
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงุฐูุจ ุฅูู: SQL Editor
4. ุงุถุบุท: New Query
5. ุงูุณุฎ ูุญุชูู: database/fix_product_rls_policies.sql
6. ุงูุตู ุงูููุฏ
7. ุงุถุบุท: Run
8. ุงูุชุธุฑ: โ Success
```

### ุงูุฎุทูุฉ 2: ุฅุนุงุฏุฉ ุชุญููู Schema Cache

```
1. ุงุฐูุจ ุฅูู: Supabase Dashboard
2. ุงุฎุชุฑ: Settings (ุฃุณูู ุงููุณุงุฑ)
3. ุงุฎุชุฑ: API
4. ุงุจุญุซ ุนู: Reload schema cache
5. ุงุถุบุท ุงูุฒุฑ ุงูุฃุญูุฑ
6. ุงูุชุธุฑ: 10 ุซูุงูู
```

### ุงูุฎุทูุฉ 3: ุงูุจูุงุก ูุงููุดุฑ

```bash
# ุชุญุฏูุซ ุงูุจูุงูุงุช
cd /path/to/project

# ุงูุจูุงุก
npm run build

# ุงููุดุฑ
git add .
git commit -m "Fix product page RLS and timeout issues"
git push
```

### ุงูุฎุทูุฉ 4: ุงูุงุฎุชุจุงุฑ

```
1. ุงุฐูุจ ุฅูู: /dashboard/vendor/products/new
2. ูุฌุจ ุชุญููู ุงูุตูุญุฉ ูู ุซุงููุชูู
3. ููุก ุงููููุฐุฌ
4. ุงุถุบุท: ุญูุธ
5. ูุฌุจ ูุญูุธ ุจูุฌุงุญ! โ
```

---

## ุงููุชูุฌุฉ ุงููุชููุนุฉ ๐

### ูุจู ุงูุฅุตูุงุญ:
```
โฐ 0 ุซุงููุฉ   : ุงููุณุชุฎุฏู ูุฏุฎู ุงูุตูุญุฉ
โณ 5 ุซูุงูู  : "ุฌุงุฑู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช"
โณ 10 ุซูุงูู : "ุฌุงุฑู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช" (ูุง ูุฒุงู)
โณ 30 ุซุงููุฉ : "ุฌุงุฑู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช" (ูุง ูุฒุงู!)
๐ซ ุงููุณุชุฎุฏู ูุบุถุจ ููุชุฑู ุงููููุน
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
โฐ 0 ุซุงููุฉ   : ุงููุณุชุฎุฏู ูุฏุฎู ุงูุตูุญุฉ
โณ 1 ุซุงููุฉ  : ูุญููู ุงูุจูุงูุงุช
โ 2 ุซุงููุฉ  : ุงูุตูุญุฉ ุฌุงูุฒุฉ!
โ 5 ุซูุงูู  : ูุถูู ููุชุฌ
โ 7 ุซูุงูู  : ุงูููุชุฌ ุญูุธ ุจูุฌุงุญ!
๐ ุงููุณุชุฎุฏู ุณุนูุฏ ุฌุฏุงู
```

---

## ๐ ุชุดุฎูุต ุงููุดุงูู

ูู ูุง ุฒุงูุช ุงููุดููุฉุ ุงุชุจุน:

### 1. ุงุถุบุท F12 ูุงูุชุญ Console
```
ุงุจุญุซ ุนู ุฑุณุงุฆู ุงูุฎุทุฃ ุงูุญูุฑุงุก
ุงูุณุฎ ุงูุฑุณุงูุฉ ูุงููุฉ
```

### 2. ุชุญูู ูู Network
```
F12 โ Network
ุฃุถู ููุชุฌ ุฌุฏูุฏ
ุงุจุญุซ ุนู request ูุนูุง "products"
ุงุถุบุท ุนูููุง ูุดูู ุงูู Response
```

### 3. ุชุญูู ูู Supabase
```
ุงุฐูุจ ุฅูู: SQL Editor
ุงูุชุจ: SELECT * FROM products LIMIT 1;
ุดุบูู ุงูู query
ุฅุฐุง ุธูุฑ ูุชุงุฆุฌ = Database ูุนูู
```

### 4. ุฃุนุฏ ุชุญููู Schema Cache
```
Supabase Settings โ API โ Reload schema cache
ุงูุชุธุฑ 10 ุซูุงูู
```

---

## ๐ ููุฎุต ุงููููุงุช ุงููุนุฏููุฉ

| ุงูููู | ุงูุชุนุฏูู |
|------|---------|
| `components/ProtectedRoute.tsx` | โ ุฅุถุงูุฉ timeout + error handling |
| `contexts/AuthContext.tsx` | โ ุฅุถุงูุฉ timeout + retry |
| `app/dashboard/vendor/products/new/page.tsx` | โ ุฅุถุงูุฉ timeout + ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ |
| `database/force_rebuild.sql` | โ ุชุญุฏูุซ RLS policies |
| `database/fix_product_rls_policies.sql` | โ ุฌุฏูุฏ - ุชุทุจูู ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ |

---

## ๐ ุงูุฎุทูุฉ ุงูุชุงููุฉ

ุงูุขู ุงููุธุงู ุฌุงูุฒ ููู:
- โ ุฅุถุงูุฉ ููุชุฌุงุช
- โ ุชุนุฏูู ุงูููุชุฌุงุช
- โ ุญุฐู ุงูููุชุฌุงุช
- โ ุฑุคูุฉ ุฌููุน ููุชุฌุงุช ุงูุจุงุฆุน
- โ ุฅุฏุงุฑุฉ ุงููุฆุงุช ูุงูุฃุณุนุงุฑ
- โ ุฑูุน ุงูุตูุฑ

**ุงูุจุฏุก ุงูุขู! ๐**
